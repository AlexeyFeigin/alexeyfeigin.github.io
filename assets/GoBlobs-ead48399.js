import{_ as J,a as ut}from"./_plugin-vue_export-helper-4d4f4928.js";import{t as K}from"./utils-c7a0ca2b.js";import{d as ft,r as k,o as dt,b as ht,e as D,f as Z,g as f,m as G,i as S,p as V,h as B,k as O,t as M,l as I,q as pt,s as vt}from"./index-4b33afe4.js";var L=function(u,i){return L=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,s){o.__proto__=s}||function(o,s){for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(o[a]=s[a])},L(u,i)};function et(u,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");L(u,i);function o(){this.constructor=u}u.prototype=i===null?Object.create(i):(o.prototype=i.prototype,new o)}function H(u,i){var o=typeof Symbol=="function"&&u[Symbol.iterator];if(!o)return u;var s=o.call(u),a,c=[],g;try{for(;(i===void 0||i-- >0)&&!(a=s.next()).done;)c.push(a.value)}catch(E){g={error:E}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(g)throw g.error}}return c}function tt(u,i,o){if(o||arguments.length===2)for(var s=0,a=i.length,c;s<a;s++)(c||!(s in i))&&(c||(c=Array.prototype.slice.call(i,0,s)),c[s]=i[s]);return u.concat(c||Array.prototype.slice.call(i))}var ot=function(){function u(){this.t=0}return Object.defineProperty(u.prototype,"length",{get:function(){return this.t},enumerable:!1,configurable:!0}),u.prototype.size=function(){return this.t},u.prototype.empty=function(){return this.t===0},u}();(function(u){et(i,u);function i(){return u!==null&&u.apply(this,arguments)||this}return i})(ot);var yt=function(u){et(i,u);function i(o,s,a){o===void 0&&(o=[]),s===void 0&&(s=function(A,w){return A>w?-1:A<w?1:0}),a===void 0&&(a=!0);var c=u.call(this)||this;if(c.i=s,Array.isArray(o))c.u=a?tt([],H(o),!1):o;else{c.u=[];var g=c;o.forEach(function(A){g.u.push(A)})}c.t=c.u.length;for(var E=c.t>>1,P=c.t-1>>1;P>=0;--P)c.o(P,E);return c}return i.prototype.h=function(o){for(var s=this.u[o];o>0;){var a=o-1>>1,c=this.u[a];if(this.i(c,s)<=0)break;this.u[o]=c,o=a}this.u[o]=s},i.prototype.o=function(o,s){for(var a=this.u[o];o<s;){var c=o<<1|1,g=c+1,E=this.u[c];if(g<this.t&&this.i(E,this.u[g])>0&&(c=g,E=this.u[g]),this.i(E,a)>=0)break;this.u[o]=E,o=c}this.u[o]=a},i.prototype.clear=function(){this.t=0,this.u.length=0},i.prototype.push=function(o){this.u.push(o),this.h(this.t),this.t+=1},i.prototype.pop=function(){if(this.t!==0){var o=this.u[0],s=this.u.pop();return this.t-=1,this.t&&(this.u[0]=s,this.o(0,this.t>>1)),o}},i.prototype.top=function(){return this.u[0]},i.prototype.find=function(o){return this.u.indexOf(o)>=0},i.prototype.remove=function(o){var s=this.u.indexOf(o);return s<0?!1:(s===0?this.pop():s===this.t-1?(this.u.pop(),this.t-=1):(this.u.splice(s,1,this.u.pop()),this.t-=1,this.h(s),this.o(s,this.t>>1)),!0)},i.prototype.updateItem=function(o){var s=this.u.indexOf(o);return s<0?!1:(this.h(s),this.o(s,this.t>>1),!0)},i.prototype.toArray=function(){return tt([],H(this.u),!1)},i}(ot);const C=u=>(pt("data-v-fd8abdcc"),u=u(),vt(),u),_t={class:"d-flex justify-center"},mt={class:"d-flex flex-column align-center"},gt={style:{width:"100%",position:"relative"}},wt={class:"d-flex flex-column align-center",style:{width:"90%"}},bt=C(()=>f("div",{class:"pb-5"},[f("span",{class:"text-h5 font-weight-black text-red"},"GoÂ "),f("span",{class:"text-h5 font-weight-black text-blue"},"Blobs")],-1)),Et=C(()=>f("div",{class:"d-flex justify-center w-100"},[f("div",{class:"pb-4 text-h6"},"Rules")],-1)),xt=C(()=>f("div",{style:{"padding-left":"20%"}},[f("ul",null,[f("li",null,"Take turns placing blobs on the playing area"),f("li",null,"Alternatively, you may pass your turn"),f("li",null,"When a blob is not touching any empty area, it suffocates and dies"),f("li",null,"Two consecutive passes end the game"),f("li",null,"A player's territory consists of their blobs and any uncontested areas they have surrounded"),f("li",null,"The player with the most territory wins")])],-1)),St={class:"mt-6"},kt=C(()=>f("div",{class:"mt-6"},"Click or tap to make your first move",-1)),Ct={key:0},At={class:"d-flex flex-wrap mb-3 text-body-1"},Bt=C(()=>f("div",{class:"mr-auto"},"Red territory:",-1)),Ot=C(()=>f("div",{class:"break"},null,-1)),Mt=C(()=>f("div",{class:"mr-auto"},"Blue territory:",-1)),h=500,Pt=3086,U="white",x=-1,Tt=ft({__name:"GoBlobs",setup(u){const i=k("red"),o=k(!1),s=k(!0),a={winner:void 0,territory:{red:void 0,blue:void 0,total:h*h}},c=k(!0),g=new Map([["red",[244,67,54,255]],["blue",[33,150,243,255]],["white",[255,255,255,255]]].map(([t,n])=>[t,new Uint8ClampedArray(n)]));function E(t){if(t==="red")return"blue";if(t==="blue")return"red";throw new Error(`Invalid other color request: ${t}`)}const P=k("human"),A=k(!1),w=Array.from(Array(h),()=>J.range(h).map(()=>x)),$=new ImageData(new Uint8ClampedArray(Array.from(Array(h*h*4),(t,n)=>g.get(U)[n%4])),h,h),v=new Map;let F=-1;const j={color:U,locationSet:new Map,boundary:[]};function T({x:t,y:n},r){var l;if(w[t][n]=r,r!==x){const e=v.get(r).locationSet;((l=e.get(t))==null?void 0:l.add(n))??e.set(t,new Set([n]))}}const Q=k(null);let q=null;dt(()=>{q=Q.value.getContext("2d")}),ht(()=>{var t;document.title="Go Blobs",(t=document.querySelector("meta[name=viewport]"))==null||t.setAttribute("content","width=542")});async function W({offsetX:t,offsetY:n}){if(c.value=!1,!!s.value&&0<=t&&t<h&&0<=n&&n<h){const{isSelfCapture:r,isMerged:l}=X(t,n,i.value,N);r?(await new Promise(e=>setTimeout(e)),await new Promise(e=>setTimeout(e,333)),o.value=!l):o.value=!1,N(),i.value=E(i.value)}}function N(){var n;const t=$.data;for(let r=0;r<h;r++)for(let l=0;l<h;l++){const e=((n=v.get(w[l][r]))==null?void 0:n.color)??U;t.set(g.get(e),(r*h+l)*4)}q.putImageData($,0,0),A.value&&(q.strokeStyle="rgb(0 0 0 / 20%)",v.forEach(({boundary:r})=>r.forEach(({x:l,y:e})=>q.strokeRect(l,e,1,1))))}function nt(){c.value=!1,o.value?rt():(i.value=E(i.value),o.value=!0)}function rt(){s.value=!1,v.forEach(({color:t,boundary:n},r)=>{n.forEach(({x:l,y:e})=>{if(w[l][e]===x){const{isFound:p,locationSet:d}=ct({x:l,y:e},E(t));p||d.forEach((m,_)=>m.forEach(y=>T({x:_,y},r)))}})}),N(),a.territory.red=0,a.territory.blue=0,v.forEach(({color:t,locationSet:n})=>{n.forEach(r=>{a.territory[t]+=r.size})}),a.territory.red>a.territory.blue?a.winner="red":a.territory.red<a.territory.blue?a.winner="blue":a.winner=void 0}function it(){for(let t=0;t<h;t++)for(let n=0;n<h;n++)w[t][n]=x;v.clear(),j.locationSet.forEach(t=>t.clear()),N(),i.value="red",o.value=!1,s.value=!0}function X(t,n,r,l){let e={isSelfCapture:!1,isMerged:!1};const p=m=>Math.sqrt((m.x-t)**2+(m.y-n)**2);let d=w[t][n]??K();if(d===x){v.set(++F,{color:r,locationSet:new Map([[t,new Set([n])]]),boundary:R({x:t,y:n})}),d=F,T({x:t,y:n},d);const m=new yt(v.get(d).boundary,(y,b)=>p(y)-p(b),!1);let _=0;for(;!m.empty()&&_<Pt;){const y=m.pop(),b=w[y.x][y.y];b!==d&&(b===x?(T(y,d),R(y).forEach(z=>m.push(z)),_++):v.get(b).color===i.value&&(e.isMerged=!0,st(b,d,m,v.get(d).boundary),d=b))}e.isSelfCapture=at(d,l)}else({x:t,y:n}=lt(v.get(d).boundary,p)??K("Group with no boundary")),e=X(t,n,r,l);return e}function R({x:t,y:n}){return[{x:t-1,y:n},{x:t,y:n-1},{x:t+1,y:n},{x:t,y:n+1}].filter(r=>0<=r.x&&r.x<h&&0<=r.y&&r.y<h)}function st(t,n,r,l){if(t===n)throw new Error(`Attempting to merge group ${t} into itself`);const e=v.get(t);v.get(n).locationSet.forEach((d,m)=>d.forEach(_=>T({x:m,y:_},t))),e.boundary.forEach(d=>r.push(d)),e.boundary=l,v.delete(n)}function at(t,n){const r=new Set,l=e=>{for(;e.length>0;){const{x:p,y:d}=e[e.length-1];if(w[p][d]===x)break;e.pop()}return e.length===0};if(v.forEach(({boundary:e},p)=>{p!==t&&l(e)&&r.add(p)}),r.size>0)r.forEach(e=>Y(e));else if(l(v.get(t).boundary))return n==null||n(),Y(t),!0;return!1}function Y(t){v.get(t).locationSet.forEach((n,r)=>n.forEach(l=>{T({x:r,y:l},x),J.chain(R({x:r,y:l})).map(({x:e,y:p})=>w[e][p]).filter(e=>e!==t&&e!==x).uniq().forEach(e=>v.get(e).boundary.push({x:r,y:l})).value()})),v.delete(t)}function lt(t,n){let r=1/0,l=null;return t.forEach(e=>{if(w[e.x][e.y]===x){const p=n(e);p<r&&(r=p,l=e)}}),l}function ct(t,n){var p,d,m;const r=[t];let l=!1;const e=new Map;for(;!l&&r.length>0;){const{x:_,y}=r.pop();if(!((p=e.get(_))!=null&&p.has(y))){const b=w[_][y];b===x?(d=j.locationSet.get(_))!=null&&d.has(y)?l=!0:(((m=e.get(_))==null?void 0:m.add(y))??e.set(_,new Set([y])),r.push(...R({x:_,y}))):v.get(b).color===n&&(l=!0)}}return l&&e.forEach((_,y)=>_.forEach(b=>{var z;return((z=j.locationSet.get(y))==null?void 0:z.add(b))??j.locationSet.set(y,new Set([b]))})),{isFound:l,locationSet:e}}return(t,n)=>{const r=D("v-sheet"),l=D("v-btn"),e=D("v-col"),p=D("v-row"),d=D("v-container");return O(),Z("div",_t,[f("div",mt,[f("div",gt,[c.value?(O(),G(r,{key:0,contained:"",width:h,height:h,class:"intro-overlay d-flex justify-center align-center",style:{position:"absolute"}},{default:S(()=>[f("div",wt,[bt,Et,xt,f("div",St,"Playing against "+M(P.value.toUpperCase())+" on this device",1),kt])]),_:1})):V("",!0),c.value?(O(),G(r,{key:1,onClick:W,width:h,height:h,class:"intro-overlay",style:{position:"absolute",opacity:"0","z-index":"2000"}})):V("",!0)]),f("canvas",{id:"canvas",ref_key:"canvas",ref:Q,width:h,height:h,onClick:W},null,512),B(d,{id:"controls"},{default:S(()=>[s.value?(O(),G(p,{key:0},{default:S(()=>[B(e,{offset:"3",cols:"6",class:"d-flex flex-column align-center"},{default:S(()=>[B(l,{color:i.value,onClick:nt,elevation:"1",style:{"padding-left":"70px","padding-right":"70px"}},{default:S(()=>[I("Pass")]),_:1},8,["color"]),o.value?(O(),Z("div",Ct,"(End game)")):V("",!0)]),_:1})]),_:1})):(O(),G(p,{key:1},{default:S(()=>[B(e,{offset:"2",cols:"8",class:"d-flex flex-column align-center"},{default:S(()=>[B(r,{color:a.winner,class:"mb-2 px-16 lineWidth text-h6"},{default:S(()=>[I(M((a.winner===void 0?"Draw":`${a.winner} wins`).toUpperCase()),1)]),_:1},8,["color"]),f("div",At,[Bt,f("div",null,M(a.territory.red)+" / "+M(a.territory.total),1),Ot,Mt,f("div",null,M(a.territory.blue)+" / "+M(a.territory.total),1)]),B(l,{onClick:it,elevation:"1"},{default:S(()=>[I("New game")]),_:1})]),_:1})]),_:1}))]),_:1})])])}}});const Nt=ut(Tt,[["__scopeId","data-v-fd8abdcc"]]);export{Nt as default};
